<IfModule mod_rewrite.c>

    Options -MultiViews

    RewriteEngine On

	# Serve pre-compressed Brotli assets
	RewriteCond %{HTTP:Accept-Encoding} br
	RewriteCond %{REQUEST_FILENAME}.br -f
	RewriteRule ^(.*)$ $1.br [L]

	# Serve pre-compressed gzip assets
	RewriteCond %{HTTP:Accept-Encoding} gzip
	RewriteCond %{REQUEST_FILENAME}.gz -f
	RewriteRule ^(.*)$ $1.gz [L]

	# Force HTTPS
    RewriteCond %{HTTPS} !on
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

</IfModule>

<IfModule mod_deflate.c>

	SetOutputFilter DEFLATE

	AddOutputFilterByType DEFLATE application/json application/javascript application/rss+xml application/vnd.ms-fontobject application/x-font application/x-font-opentype application/x-font-otf application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/opentype font/otf font/ttf image/svg+xml image/x-icon text/css text/html text/javascript text/plain text/xml image/png image/jpg image/jpeg image/webp image/gif application/x-php application/php

</IfModule>
<IfModule mod_brotli.c>

	SetOutputFilter BROTLI_COMPRESS

	AddOutputFilterByType BROTLI_COMPRESS application/javascript text/css text/html text/javascript text/plain text/xml

</IfModule>

<ifModule mod_gzip.c>

	mod_gzip_on Yes
	mod_gzip_dechunk Yes
	mod_gzip_item_include file .(html?|txt|css|js|json|php|pl)$
	mod_gzip_item_include handler ^cgi-script$
	mod_gzip_item_include mime ^font/.*
	mod_gzip_item_include mime ^text/.*
	mod_gzip_item_include mime ^application/x-javascript.*
	mod_gzip_item_exclude mime ^image/.*
	mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*

</ifModule>

<IfModule mod_headers.c>

	Header set Access-Control-Allow-Origin "*"

    <FilesMatch "\.html$">

        Header set Cache-Control "no-cache"

    </FilesMatch>

    <FilesMatch "\.js$">

        Header set Cache-Control "max-age=31536000, private"

    </FilesMatch>

	<FilesMatch "\.(css|json|webp|svg|jpg|jpeg|png|gif)$">

        Header set Cache-Control "max-age=31536000"

    </FilesMatch>

	<FilesMatch "\sw\.js$">

        Header set Cache-Control "max-age=0, no-cache"

    </FilesMatch>

</IfModule>

# Specify Brotli-encoded assets
<Files *.js.br>
	AddType "text/javascript" .br
	AddEncoding br .br
</Files>
<Files *.css.br>
	AddType "text/css" .br
	AddEncoding br .br
</Files>
<Files *.html.br>
	AddType "text/html" .br
	AddEncoding br .br
</Files>

# Specify gzip-encoded assets
<Files *.js.gz>
	AddType "text/javascript" .gz
	AddEncoding gz .gz
</Files>
<Files *.css.gz>
	AddType "text/css" .gz
	AddEncoding gz .gz
</Files>
<Files *.html.gz>
	AddType "text/html" .gz
	AddEncoding gz .gz
</Files>
